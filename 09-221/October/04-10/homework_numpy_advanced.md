## Задача 1. Декоратор «стабилизации» вычислений

**Условие**  
Реализуйте декоратор `stabilize`, который перехватывает вычислительные ошибки (`FloatingPointError`, `OverflowError`, `ValueError`).  
Если при первом запуске функции произошла ошибка — декоратор должен **повторить вызов**, но предварительно округлить все массивы/скаляры в аргументах до 3 знаков (`np.round(..., 3)`).  
Если ошибка повторится — вернуть `np.nan` и вывести сообщение `"Ошибка вычисления в <имя_функции>"`.

**Подсказка**  
- Используйте `np.seterr(all='raise')` внутри декорируемой функции при необходимости.  
- Для округления аргументов можно рекурсивно обойти `args`/`kwargs` и применять `np.round` для `np.ndarray` и `round()` для чисел.


**Ожидаемый результат**  
Декоратор стабильно обрабатывает функции, подобные:
```python
@stabilize
def complex_op(a, b):
    return np.exp(a) / np.log(b - a)
```
При опасных входных данных возвращает корректный результат или `np.nan` и сообщение об ошибке.

---

## Задача 2. Декоратор валидации и z-score

**Условие**  
Реализуйте декоратор `data_validator`, который проверяет входные данные:
- аргумент — одномерный `np.ndarray`,
- длина ≥ 5,
- не содержит `NaN` и `inf`.

Если проверка не проходит — выбрасывать `ValueError` с информативным сообщением.  
Примените декоратор к функции `zscore_normalize(x)` — возвращает `(x - mean)/std`.

**Подсказка**  
- Используйте `np.asarray` и `np.issubdtype` для проверки типа данных.  
- Для тестов подготовьте набор корректных и некорректных входов.


**Ожидаемый результат**  
Корректная стандартизация для валидных входов; понятные ошибки для неверных.

---

## Задача 3. Анализ производительности с объёмом данных

**Условие**  
Напишите декоратор `analyze_perf`, который для декорируемой функции:
- вычисляет время выполнения (секунды),
- оценивает суммарный объём памяти входных `np.ndarray` (сумма `.nbytes`),
- печатает отчёт в формате:
```
[analyze_perf] Функция: <имя>()
Размер данных: <MB> MB
Время выполнения: <s> сек
```
Примените его к `matmul_chain(A,B,C)` и протестируйте на матрицах размером 400×400 и 600×600.

**Подсказка**  
- Для подсчёта `nbytes` рекурсивно пройдите по `args`/`kwargs` и суммируйте `.nbytes` у `np.ndarray`.


**Ожидаемый результат**  
Отчёт о памяти и времени, пригодный для сравнения производительности.

---

## Задача 4. Авто-стабилизация обратной матрицы

**Условие**  
Реализуйте декоратор `auto_stabilize(max_retries=5)`, который при `np.linalg.LinAlgError` добавляет регуляризацию к диагонали `A + eps * I` с возрастающими `eps` (1e-6, 1e-5, 1e-4, ...) и повторяет попытку инверсии до `max_retries`.  
Если стабилизация удалась — вернуть обратную матрицу и количество попыток; если нет — выбросить `RuntimeError("Не удалось стабилизировать матрицу")`.

**Подсказка**  
- Используйте `np.eye` для регуляризации.  
- Отслеживайте число попыток и возвращайте `(A_inv, attempts)`.


**Ожидаемый результат**  
Функция `invert_matrix(A)` умеет стабилизировать плохо обусловленные матрицы.

---

## Задача 5. Мини-проект: анализ `air_quality.csv`

**Условие**  
Файл: `./air_quality.csv` (столбцы: `day,CO,NO2,SO2,O3,city`).  
Напишите функцию `analyze_air_quality(filename)` с декоратором `@safe_run`, который:
- логирует ошибки в `errors.log` и не прерывает работу,
- при ошибках записывает тип ошибки и строку данных.

Функция должна:
1. Считать CSV (`np.genfromtxt(..., dtype=str)`).
2. Преобразовать нечисловые метки (`"NaN","error","missing","invalid"`) в `np.nan`.
3. Удалить строки, где >2 NaN (по числовым полям).
4. Для каждой группы по `city`:
   - преобразовать числовые поля в `float`,
   - заменить оставшиеся NaN на среднее по городу и столбцу,
   - вычислить средние уровни (`CO, NO2, SO2, O3`),
   - определить самый высокий по среднему показатель (Most_dangerous).
5. Вернуть структурированный `np.recarray` или `list` словарей с результатами по городам.
6. Вывести аккуратную таблицу в консоль.

**Подсказка**  
- Группировка: используйте `np.unique` по столбцу `city`.  
- Для записи лога используйте обычный `open("errors.log", "a", encoding="utf-8")`.


**Ожидаемый результат**  
Таблица со строками вида:
```
City          CO    NO2    SO2    O3    Most_dangerous
Moscow        0.65  20.5   5.5    32.0  NO2
...
```

---
